# テストディレクトリ構造とテスト戦略

## ディレクトリ構造

```
test/
├── fixtures/           # テスト用の入力データ（処理前）
├── fixtures-processed/ # CLIで処理された結果（処理後）※gitignore対象
├── index.test.ts      # メインテストファイル
├── test-utils.ts      # テスト用ユーティリティ関数
├── setup.ts           # フィクスチャの依存関係インストール用スクリプト
└── .gitignore         # fixtures-processed/を無視
```

## ディレクトリの関係

- **`fixtures/`**: 型エラーを含む元の TypeScript/Vue プロジェクト（処理前の状態）
- **`fixtures-processed/`**: CLI ツールが`@ts-expect-error`コメントを挿入した後の状態

この関係により、処理前（before）と処理後（after）の状態が明確に分離されています。

## テスト戦略

### 基本的な流れ

1. **フィクスチャをコピー**

   - `fixtures/`から`fixtures-processed/`へフィクスチャをコピー
   - 元のフィクスチャは変更されない

2. **CLI ツールを実行**

   - コピーされたフィクスチャに対して CLI ツールを実行
   - 型エラー箇所に`@ts-expect-error`コメントを自動挿入

3. **型チェックで検証**
   - 処理後のコードに対して`tsc`または`vue-tsc`を実行
   - すべての型エラーが抑制され、exitCode 0（エラーなし）になることを確認

### テスト対象

- **`ts-only/`**: 純粋な TypeScript プロジェクト（`.ts`ファイル）
- **`vue-project/`**: Vue プロジェクト（`.vue`ファイル、`vue-tsc`使用）
- **`react-project/`**: ※TSX 未対応のため現在は除外

### 検証内容

各フィクスチャに対して以下を検証：

1. **型チェックの成功**
   - 処理後のコードで型エラーがゼロになっているか（最重要）
   - exitCode 0 でタイプチェッカーが終了することを確認

### TS2578 エラーへの対応

ツールは`TS2578`（不要な`@ts-expect-error`コメント）エラーも適切に処理：

- **TypeScript ファイル**: 不要なコメント行を削除
- **Vue テンプレート**:
  - 同一行にコンテンツがある場合: コメントのみ削除
  - コメントのみの行: 行ごと削除
- **Vue スクリプト**: 不要なコメント行を削除

## テスト実行

```sh
# テストの実行
bun run test
```

## 注意事項

- `fixtures-processed/`は自動生成されるため、git で管理しない
- 新しいフィクスチャを追加する場合は`fixtures/`内に配置
- 各フィクスチャは独立した TypeScript/Vue プロジェクトとして構成
